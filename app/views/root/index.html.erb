<%= content_for :title, 'ケアスク' %>

<%= content_for :javascript do %>
  <script>
    $(".question-box-placeholder").on('click', function () {
       $(this).hide();
       $(".question-box").show();
    });
  </script>
<% end %>

<% if (params[:page] || 1).to_i < 2 %>
  <%= content_for :css do %>
    <%= stylesheet_link_tag 'root' %>
  <% end %>

  <div class="top-wrapper">
    <div class="top-background"></div>
  </div>
<% end %>

<div class="container">
  <div class="row">

    <% if current_user.try(:confirmed?) %>
    <div class="<%= flex_spacing %>">
      <div class="question-box-placeholder bg-white text-silence py-2 px-3 mb-3" style="cursor: pointer;">
        <i class="fa fa-pencil"></i>
        <span>新しい質問を投稿する</span><br/>
        <small>エトセトラエトセトラ</small>
      </div>

      <%= form_for(@post, html: { class: 'hidden question-box bg-white mb-3 p-3' }) do |f| %>

        <div class="form-group">
          <%= f.text_area :body, class: 'form-control', rows: 10, placeholder: "新しい質問を投稿する\nエトセトラエトセトラ" %>
        </div>

        <div class="form-group">
          <%= f.file_field :image, class: 'form-control' %>
          <%= f.hidden_field :image_cache %>
        </div>

        <%= f.submit '投稿する', class: 'btn btn-primary btn-block', disabled: !current_user.confirmed? %>
      <% end %>
    </div>
    <% end %>

    <% @posts.each do |post| %>
      <div class="post-list__item-wrapper <%= flex_spacing %>">
        <div class="post-list__item">

          <div class="row mb-2" style="height: 30px; line-height: 30px;">
            <div class="col-1">
              <%= image_tag post.user.image_url,
                            class: 'mx-auto align-top img-thumbnail rounded-circle',
                            alt: post.user.name,
                            style: 'max-width: initial; height: 30px; padding: 0; background-color: #eee;' %>
            </div>
            <div class="col-9">
              <%= link_to post.user.name, user_path(post.user), class: 'font-weight-bold' %>さん
            </div>
            <div class="col-2">
              <small><%= distance_of_time_in_words_to_now post.updated_at %></small>
            </div>
          </div>

          <div class="row">
            <div class="col-12">
              <p><%= truncate_l post.body %></p>
            </div>
          </div>

          <div class="row">
            <div class="col-2">
              <% if post.comment_count.zero? %>
                <span class="badge badge-success">未回答</span>
              <% end %>
            </div>
            <div class="col-10 text-right">
              <% post.tags.each do |tag| %>
                <span class="badge badge-tag"><%= tag.value %></span>
              <% end %>
            </div>
          </div>

          <div class="row mt-3">
            <div class="col-10">
              <%= link_to '回答する', post_path(post), class: 'btn btn-primary', style: 'width: 90%' %>
            </div>
            <div class="col-2">
              <span class="align-middle">
                <i class="fa fa-comment-o"></i>&nbsp;<%= post.comment_count %>
              </span>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
  <%= paginate @posts %>
</div>
